// Unikeybord / Diverge TM2
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
//   _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
//   _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
//   _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
//   _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,   _______,     _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'

#include QMK_KEYBOARD_H

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

[0] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     KC_DEL,     KC_Q,       LALT_T(KC_W),       KC_F,       KC_P,       KC_B,              KC_J,       KC_L,       KC_U,       RALT_T(KC_Y),       XXXXXXX,    KC_CAPS,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     KC_BSPC,    KC_A,       KC_R,       HRM_S,      HRM_T,      KC_G,              KC_K,       HRM_N,      HRM_E,      KC_I,       KC_O,       KC_ENT,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     KC_F13,     L1_Z,       KC_X,       KC_C,       KC_D,       KC_V,              KC_M,       KC_H,       L3_SLSH,    L4_DOT,     KC_COMM,    KC_QUOT,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     KC_PSCR,    OSL(5),     XXXXXXX,    KC_ESC,     LGUI_T(KC_TAB),                LT(2,KC_SPC),           KC_BSPC,    KC_VOLD,    KC_VOLU,    XXXXXXX
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[1] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    _______,    KC_HOME,    KC_UP,      KC_END,     KC_PGUP,           _______,    KC_AMPR,    KC_LBRC,    KC_RBRC,    KC_RPRN,    KC_BSPC,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    KC_LEFT,    KC_DOWN,    KC_RGHT,    KC_SPC,            _______,    KC_LPRN,    KC_LCBR,    KC_RCBR,    KC_RPRN,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    KC_BSPC,    KC_DEL,     KC_ENT,     KC_PGDN,           _______,    KC_EQL,     KC_LABK,    KC_RABK,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     QK_BOOT,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,   _______,     _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[2] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    KC_MENU,    KC_4,       KC_5,       KC_6,       KC_EQL,            _______,    KC_HOME,    KC_UP,      KC_END,     _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_0,       KC_1,       KC_2,       KC_3,       KC_DOT,            _______,    KC_LEFT,    KC_DOWN,    KC_RGHT,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_UNDS,    KC_7,       KC_8,       KC_9,       KC_MINS,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,   _______,     _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[3] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    _______,    KC_PIPE,    KC_GRV,     _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_EXLM,    KC_SCLN,    KC_DQT,     KC_COLN,    KC_PERC,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_UNDS,    KC_BSLS,    KC_TILD,    KC_COMM,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,    _______,    _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[4] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_QUES,    KC_AT,      KC_HASH,    KC_DLR,     KC_PERC,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    KC_CIRC,    KC_AMPR,    KC_ASTR,    KC_PLUS,    KC_MINS,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,    _______,    _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[5] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    _______,    KC_F4,      KC_F5,      KC_F6,      KC_F10,            _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    KC_F1,      KC_F2,      KC_F3,      KC_F11,            _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    KC_F7,      KC_F8,      KC_F9,      KC_F12,            _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,   _______,     _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),

[6] = LAYOUT_ortho_4x12_2x2u(
// ,-------------------------------------------------------------------------.    ,-----------------------------------------------------------------------.
     _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
      _______,    _______,    _______,    _______,    _______,    _______,           _______,    KC_COMM,   KC_DOT,     _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,    _______,           _______,    _______,    _______,    _______,    _______,    _______,
// |-----------+-----------+-----------+-----------+-----------+-------------|    |-----------+-----------+-----------+-----------+-----------+-----------|
     _______,    _______,    _______,    _______,    _______,                       _______,                _______,    _______,   _______,     _______
// `-----------+-----------+-----------+-----------+-------------------------'    `-----------------------+-----------+-----------+-----------+-----------'
),
};



// SHIFT + BACKSPACE = DELETE
// Initialize variable holding the binary
// representation of active modifiers.
uint8_t mod_state;
bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    mod_state = get_mods();
    switch (keycode) {

    case KC_BSPC:
        {
        // Initialize a boolean variable that keeps track
        // of the delete key status: registered or not?
        static bool delkey_registered;
        if (record->event.pressed) {
            // Detect the activation of either shift keys
            if (mod_state & MOD_MASK_SHIFT) {
                // First temporarily canceling both shifts so that
                // shift isn't applied to the KC_DEL keycode
                del_mods(MOD_MASK_SHIFT);
                register_code(KC_DEL);
                // Update the boolean variable to reflect the status of KC_DEL
                delkey_registered = true;
                // Reapplying modifier state so that the held shift key(s)
                // still work even after having tapped the Backspace/Delete key.
                set_mods(mod_state);
                return false;
            }
        } else { // on release of KC_BSPC
            // In case KC_DEL is still being sent even after the release of KC_BSPC
            if (delkey_registered) {
                unregister_code(KC_DEL);
                delkey_registered = false;
                return false;
            }
        }
        // Let QMK process the KC_BSPC keycode as usual outside of shift
        return true;
    }

    // Home Row Mod related temporary disabling of modifiers
    case RSFT_T(KC_N):
        if (record->event.pressed && record->tap.count > 0) {
            // detect modifier
            if (get_mods() & MOD_BIT(KC_RCTL)) {
                // temporarily disable modifier
                unregister_mods(MOD_BIT(KC_RCTL));
                tap_code(KC_E);
                tap_code(KC_N);
                // restore the mod state
                add_mods(MOD_BIT(KC_RCTL));
                // to prevent QMK from processing the orignal key
                return false;
            }
        }
         /*else process as usual.*/
        return true;

    case LSFT_T(KC_T):
        if (record->event.pressed && record->tap.count > 0) {
            if (get_mods() & MOD_BIT(KC_LCTL)) {
                unregister_mods(MOD_BIT(KC_LCTL));
                tap_code(KC_S);
                tap_code(KC_T);
                add_mods(MOD_BIT(KC_LCTL));
                return false;
            }
        }
        return true;

    case RCTL_T(KC_E):
        if (record->event.pressed && record->tap.count > 0) {
            if (get_mods() & MOD_BIT(KC_RALT)) {
                unregister_mods(MOD_BIT(KC_RALT));
                tap_code(KC_I);
                tap_code(KC_E);
                add_mods(MOD_BIT(KC_RALT));
                return false;
            }
        }
        return true;

    case LCTL_T(KC_S):
        if (record->event.pressed && record->tap.count > 0) {
            if (get_mods() & MOD_BIT(KC_LALT)) {
                unregister_mods(MOD_BIT(KC_LALT));
                tap_code(KC_R);
                tap_code(KC_S);
                add_mods(MOD_BIT(KC_LALT));
                return false;
            }
        }
        return true;

    case KC_O:
        if (record->event.pressed && record->tap.count > 0) {
            if (get_mods() & MOD_BIT(KC_LALT)) {
                unregister_mods(MOD_BIT(KC_LALT));
                tap_code(KC_R);
                tap_code(KC_S);
                add_mods(MOD_BIT(KC_LALT));
                return false;
            }
        }
        return true;
    }
    return true;
};
